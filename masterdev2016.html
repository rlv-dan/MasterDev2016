<!doctype html>
<!--
                               ,|     
                             //|                              ,|
                           //,/                             -~ |
                         // / |                         _-~   /  ,
                       /'/ / /                       _-~   _/_-~ |
                      ( ( / /'                   _ -~     _-~ ,/'
                       \~\/'/|             __--~~__--\ _-~  _/,
               ,,)))))));, \/~-_     __--~~  --~~  __/~  _-~ /
            __))))))))))))));,>/\   /        __--~~  \-~~ _-~
           -\(((((''''(((((((( >~\/     --~~   __--~' _-~ ~|
  --==//////((''  .     `)))))), /     ___---~~  ~~\~~__--~ 
          ))| @    ;-.     (((((/           __--~~~'~~/
          ( `|    /  )      )))/      ~~~~~__\__---~~__--~~--_
             |   |   |       (/      ---~~~/__-----~~  ,;::'  \         ,
             o_);   ;        /      ----~~/           \,-~~~\  |       /|
                   ;        (      ---~~/         `:::|      |;|      < >
                  |   _      `----~~~~'      /      `:|       \;\_____// 
            ______/\/~    |                 /        /         ~------~
          /~;;.____/;;'  /          ___----(   `;;;/               
         / //  _;______;'------~~~~~    |;;/\    /          
        //  | |                        /  |  \;;,\              
       (<_  | ;                      /',/-----'  _>
        \_| ||_                     //~;~~~~~~~~~ 
            `\_|                   (,~~ 
                                    \~\ 
                                     ~~ 

-->

<html>
<head>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link href='https://fonts.googleapis.com/css?family=Righteous' rel='stylesheet' type='text/css'>

	<style>

		* {
			box-sizing: border-box;
			margin: 0;
		}

		html, body {
			height: 100%;
			font-family: 'Righteous', sans-serif;
			color: white;
		}
		
		h1 {
			font-size: 5vw;
			color: white;
			text-shadow: -1px -1px 0 deeppink, 1px -1px 0 deeppink, -1px 1px 0 deeppink, 1px 1px 0 deeppink;
		}
		h2 {
			margin-top: 1vw;
			font-size: 2.5vw;
			color: white;
			text-shadow: -1px -1px 0 deeppink, 1px -1px 0 deeppink, -1px 1px 0 deeppink, 1px 1px 0 deeppink;
		}
		.pinktext {
			color: white;
			text-shadow: -1px -1px 0 deeppink, 1px -1px 0 deeppink, -1px 1px 0 deeppink, 1px 1px 0 deeppink;
		}
		p {
			font-size: 2vmin;
		}

		div.step {
			width: 100%;
			height: 100%;
			position: relative;
			
		}
		
		#step-choose {
			background-image: url('start.png');
			background-size: cover;
		}

		#step-loading1 {
			background-color: #fd82b1;
		}
		#step-loading2 {
			background-color: #fd82b1;
		}

		#step-gotpictures {
			background-color: #de4887;
		}


		#step-final {
			background-image: url('fluff.jpg');
			background-size: cover;
		}
		

		#step-choose .textbox {
			position: absolute;
			bottom: 50px;
			width: 100%;
			text-align: center;
		}

		#step-loading1 > div, #step-loading2 > div {
			text-align: center;
			color: white;
			max-width: 60%;
		}

		#step-loading1 > div h3, #step-loading2 > div h3 {
			font-size: 4vw;
		}

		.valign {
			display: -ms-flexbox;
			display: -webkit-flex;
			display: flex;

			-ms-flex-align: center;
			-webkit-align-items: center;
			-webkit-box-align: center;

			align-items: center;
 			justify-content: center;
		}

		.valign-inner {
			text-align: center;
		}

		#imageboxes {
			padding-top: 50px;
			padding-left: 6vw;
		}

		.picbox {
			float: left;
			width: 15vw;
			height: 15vw;
			background-size: cover;
			margin: 0 3vw 3vw 0;
			cursor: pointer;
		}

		.step-final-list {
			float: left;
			width: 45%;
			color: white;
    		font-size: 1.75vw;
			padding: 3%;
		}
		.step-final-widgets {
			float: left;
			width: 45%;
			padding: 3%;
		}


	</style>
	
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"  > </script>
	<script   src="unicorn.js" > </script>

</head>
<body>

	<a name="step-choose"></a>
	<div id="step-choose" class="step">
		<div class="textbox">
				<h1>Hungrigare än vanligt?</h1>
				<p>
					<span class="pinktext">- Jag vill ha:</span>
					<a class="choose-category btn btn-primary" data-search="unhealthy%20food">Onyttigt</a>
					<a class="choose-category btn btn-primary" data-search="german%20food">Tyskt</a>
					<a class="choose-category btn btn-primary" data-search="spaghetti">Spagetti</a>
					<a class="choose-category btn btn-primary" data-search="bacon">Bacon</a>
					<a class="choose-category btn btn-primary" data-search="healthy%20food">Nyttigt</a>
					<a class="choose-category btn btn-primary" data-search="saurkraut">Surkål</a>
					<a class="choose-category btn btn-primary" data-search="burgers">Burgare</a>
					<a class="choose-category btn btn-primary" data-search="north%20korean%20food">Nordkoreanskt</a>
					<a class="choose-category btn btn-primary" data-search="snakes%20cooking">Kobror</a>
				</p>				
		</div>

	</div>

	<a name="step-loading1"></a>
	<div id="step-loading1" class="step valign">
		<div class="valign-inner">
			<img src="calculator.gif" width="128" height="186">
			<h3>Nu utför vår avancerade AI beräkningar i molnet för att kalkylera din personliga meny...</h3>
			
		</div>
	</div>

	<a name="step-gotpictures"></a>
	<div id="step-gotpictures" class="step valign">
			<div class="valign-inner">
				<h1>Nom nom nom - välj något!</h1>
				<div id="imageboxes">
				</div>
			</div>
	</div>

	<a name="step-loading2"></a>
	<div id="step-loading2" class="step valign">
		<div class="valign-inner">
			<img src="calculator.gif" width="128" height="186">
			<h3>Working on it...</h3>
		</div>
	</div>

	<a name="step-final"></a>
	<div id="step-final" class="step">

		<div class="step-final-list"></div>
		<div class="step-final-widgets">

			<div class="step-final-content">
				<h2>Eller så går du till en restaurang som serverar detta:</h2>
				<div id="google-map" style = "height: 300px; width: 400px;">		
				</div>
					<script>
			var map;
			var infowindow;
			function initMap() {
				map = new google.maps.Map(document.getElementById('google-map'), {
						center : {
							lat : 55.7093099,
							lng : 13.1904653
						},
						zoom : 12
					});

				infowindow = new google.maps.InfoWindow();
				}
					</script>
					<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqQX9KXcsnaFQkRszM8o0Zx3wA9jSRUwo&callback=initMap&libraries=places" async defer> </script>

					<h2>Samtidigt passar det bra att lyssna på:</h2>
					<div id="soundcloud-wrapper">
						<iframe id ="soundcloud-widget" style="display:none" width="500" height="400" scrolling="no" frameborder="no" ></iframe>
					</div>
			</div>
		</div>
	</div>


	<script>

		$( document ).ready(function() {	// ready() is guaranteed to be executed after the DOM is ready, so this is usually the best place to attach all other event handlers and run other jQuery code
			'use strict'

			var currentStep = "";

			function scrollToAnchor(aid){
				var aTag = $("a[name='"+ aid +"']");
				$('html,body').animate({scrollTop: aTag.offset().top},'slow');
			}

			$(".choose-category").on("click", function() {
				var searchFor = $(this).data("search");
				scrollToAnchor('step-loading1');
				setTimeout(function(){
					GetImages(searchFor, function(images){
						var img = "";
						for(var i=0; i<images.length; i++) {
							img += '<div class="picbox" style="background-image:url(' + images[i] + ')"></div>';
						}
						$("#imageboxes").html(img);
						scrollToAnchor('step-gotpictures');

						$(".picbox").on("click", function() {
							var imageUrl = $(this).css("background-image");
							imageUrl = imageUrl.replace('url("',"").replace('")',"");

							scrollToAnchor('step-loading2');
							analyzeImage(imageUrl, function(tags, description){
								console.log(tags);
								
								var list = "<h2>Inköpslista för att laga '" + description + "':</h2><ul>";
								for(var i=0; i<tags.length; i++) {
									list += '<li>' + tags[i] + '</li>';
								}
								list += "</ul>";
								$(".step-final-list").html(list);

								var searchTerms = tags;
								var bannedWords = ['food', 'plate', 'table', 'large', 'sitting', 'top', 'bowl', 'side', 'hot', 'covered', 'indoor', 'displayed', 'different', 'various'];
								for (var i = 0; i < bannedWords.length; i++){
									var index = searchTerms.indexOf(bannedWords[i]);
									if (index >= 0 ){
										searchTerms.splice(index, 1);
									}
								}
								Dashboard.DrawGoogleMaps(searchTerms);
								Dashboard.StartSoundcloud(searchTerms);
								setTimeout(function(){
									$(".step-final-content").show();
									scrollToAnchor('step-final');
								},2000);
							});

						});

					})
				},2000);
			});


			/* Microsoft Cognitive Services - Computer Vision API  */

			var analyzeImage = function(imageUrl, callback) {


				$.ajax({
					url: "https://api.projectoxford.ai/vision/v1.0/analyze?visualFeatures=Description,Tags,Categories",
					beforeSend: function(xhrObj){
						// Request headers
						xhrObj.setRequestHeader("Content-Type","application/json");
						xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","b6e2b5fae7004debbe3f11521b31ade6");
					},
					type: "POST",
					// Request body
					data: '{ "url": "' + imageUrl + '"}'
				})
				.done(function(data) {
					callback(data.description.tags, data.description.captions[0].text );
				})
				.fail(function() {
					console.log("Image analyzer failed...");
				});


			}
		

			/*** GOOLGE IMAGE SEARCH ***/
			function GetImages(input, callback)
			{
				// Key to Search API
				var key = "AIzaSyAnuYEIqHm3w7N_RuK8r9DdZtrpaYo1b3U";
				// cx to Google custom search engine
				var cx = "012414733199820334003:6qrva-eprqu";
						
				var startAt = Math.floor(Math.random() * 10) + 1;
				
					$.ajax({
						url: 'https://www.googleapis.com/customsearch/v1?key=' + key + '&cx=' + cx +'&q=' + input + '&searchType=image&fileType=jpg&imgSize=medium&alt=json&start=' + startAt,
						type: 'GET',
						success: function(data) {
							console.log("Success");
							var images = [];
							if(data.items.length > 0) {
								$.each(data.items, function(index, item){
									images.push(item.link);
								})
							}
							callback(images);
						},
						error: function(){console.log('Google image search failed')}
					});
			}



		});



		/* UNIT TESTING */
		
		var add = function(a,b) {
			return a + b;
		}
		
		if( add(1,2) === 3) {
			console.info("Unit testing completed sucessfully!");
		} else {
			console.error("Unit testing failed!");
		}
		
		


	</script>

</body>
</html>
